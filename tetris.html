<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
      #matrix rect {
        stroke: black;
      }

      #grid rect {
        fill: gray;
      }

      #grid line {
        stroke: black;
        stroke-dasharray: 1, 48, 1, 0;
        stroke-width: 1000;
      }
    </style>

    <script type="text/javascript" src="lib/coffee-script.js"></script>
    <script type="text/javascript" src="lib/d3.min.js"></script>
  </head>
  <body>
    <svg width="500px" height="500px" version="1.1" xmlns="http://www.w3.org/2000/svg">
      <g id="grid">
        <rect x="0" y="0" width="500" height="500" />
        <line x1="0" y1="0" x2="500" y2="0" />
        <line x1="0" y1="0" x2="0" y2="500" />
      </g>

      <g id="matrix"></g>
    </svg>

    <script type="text/coffeescript">
      bindData = (data) ->
        rect = d3.select("#matrix").selectAll("rect").data(data)

        rect
          .transition()
          .duration(750)
          .attr("x", (d) -> d.x * 50)
          .attr("y", (d) -> d.y * 50)
          .attr("width",  50)
          .attr("height", 50)
          .attr("fill", (d) -> d.fill)

        rect
          .enter()
          .append("svg:rect")

        rect
          .exit()
          .remove()

      update = ->
        d = for i in [0..50]
          {
            x: Math.floor(Math.random() * 10),
            y: Math.floor(Math.random() * 10),
            fill: "rgb(#{Math.floor(Math.random() * 255)}, #{Math.floor(Math.random() * 255)}, #{Math.floor(Math.random() * 255)})"
          }

        bindData(d)

      setInterval(update, 1000)

      update()
    </script>
  </body>
</html>
